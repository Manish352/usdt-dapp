<!DOCTYPE html>
<html>
<head>
  <title>Testnet Token Approval dApp</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers/dist/ethers.min.js"></script>
</head>
<body style="font-family: sans-serif; padding: 20px;">
  <h2>🧪 Testnet Token Approval & Revoke dApp</h2>

  <button onclick="connect()">🔌 Connect Wallet</button><br><br>

  <label>Spender (Scammer Address):</label><br>
  <input id="spender" type="text" value="0x1111111111111111111111111111111111111111" style="width: 400px;"><br><br>

  <label>Amount to Approve:</label><br>
  <input id="amount" type="number" value="100"><br><br>

  <button onclick="approve()">✅ Approve</button>
  <button onclick="revoke()">🛑 Revoke</button>

  <h3>Status:</h3>
  <pre id="status">Not connected.</pre>

  <script>
    let provider, signer, token;

    const tokenAddress = "0x22aF9c9E18C924a4e3a8C712E753e3fC5c167f81"; // Test token on Sepolia
    const abi = [
      "function approve(address spender, uint amount) public returns (bool)",
      "function allowance(address owner, address spender) public view returns (uint256)"
    ];

    async function connect() {
      if (window.ethereum) {
        provider = new ethers.providers.Web3Provider(window.ethereum);
        await provider.send("eth_requestAccounts", []);
        signer = provider.getSigner();
        token = new ethers.Contract(tokenAddress, abi, signer);
        const addr = await signer.getAddress();
        document.getElementById("status").textContent = "Connected: " + addr;
      } else {
        alert("Please install MetaMask.");
      }
    }

    async function approve() {
      const spender = document.getElementById("spender").value;
      const amount = document.getElementById("amount").value;
      try {
        const tx = await token.approve(spender, ethers.utils.parseUnits(amount, 18));
        await tx.wait();
        document.getElementById("status").textContent = "✅ Approved " + amount + " tokens to " + spender;
      } catch (err) {
        document.getElementById("status").textContent = "❌ Error: " + err.message;
      }
    }

    async function revoke() {
      const spender = document.getElementById("spender").value;
      try {
        const tx = await token.approve(spender, 0); // Reset to 0
        await tx.wait();
        document.getElementById("status").textContent = "🛑 Approval revoked for " + spender;
      } catch (err) {
        document.getElementById("status").textContent = "❌ Error: " + err.message;
      }
    }
  </script>
</body>
</html>
